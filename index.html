<html>
 <head>
  <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.css">
  <script type="text/javascript" src="node_modules/knockout/build/output/knockout-latest.js"></script>
  <script type="text/javascript">

    function loadPage(){
        
     function VMTest(){
        
      var vm = this;

        vm.personName = ko.observable('Bob');
        vm.personAge = ko.observable(123);
        vm.personEmail = ko.observable('email@email.com');

        let list = [];
        try {
          list = JSON.parse(localStorage.getItem('lst'));
        } catch (e){ }

        vm.list = ko.observableArray(list);

        vm.list.subscribe(function(newValue) {
          console.log('list updated');
          let lst = JSON.stringify(newValue);
          console.log(lst);
          localStorage.setItem('lst', lst);
        });

        vm.addItem = function(){
          
          let item = JSON.stringify({ personName: vm.personName(), personEmail: vm.personEmail() });
          vm.list.push(JSON.parse(item));
          vm.personName('');
          vm.personEmail('');
        }

        vm.removeItem = function(item){
          console.log(item);
          console.log(vm.list);
          vm.list(vm.list().filter(function(person){ return person.personName != item.personName; }));
        }
      }

      ko.applyBindings(new VMTest(), document.getElementById('gauge_div'));
    }

  </script>  
 </head>
 <body onload="loadPage()">
  <div id="gauge_div" class="container-fluid">
    <h1>Crud com knockout</h1>
    <form class="well">
      <div class="row">
        <div class="form-group">
          <div class="col-lg-6">
            <label for="exampleInputEmail1">Nome</label>
            <input type="text" data-bind="value: personName" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email" />        
          </div>
          <div class="col-lg-6">
            <label for="exampleInputPassword1">Email</label>
            <input type="email" class="form-control" id="exampleInputPassword1" placeholder="Password" data-bind="value: personEmail" />
          </div>          
        </div>            
      </div>
      <br/>      
      <button type="button"  class="btn btn-primary" data-bind="click: addItem">
        <i class="glyphicon glyphicon-plus"></i>
        Adicionar
      </button>   
      <br/>              
      <br/>      
      <table class="table">
          <thead>
              <tr><th>Nome</th><th>Email</th><th style="width: 1%"></th></tr>
          </thead>
          <tbody data-bind="foreach: list">
              <tr>
                  <td data-bind="text: personName"></td>
                  <td data-bind="text: personEmail"></td>
                  <td style="width: 1%">
                    <button class="btn btn-danger" data-bind="click: $root.removeItem"><i class="glyphicon glyphicon-trash"></i></button>
                  </td>
              </tr>
          </tbody>
      </table>      
    </form>    
  </div>
 </body>
</html>
